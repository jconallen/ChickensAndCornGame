<!DOCTYPE html>
<html lang="en">
<head>
	<title>Chickens and Corn Game</title>
  	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
 	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css" />	
  	<link rel="stylesheet" href="css/cnc.css" >
 	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> 
	<script src="https://cdnjs.cloudflare.com/ajax/libs/todc-bootstrap/3.3.7-3.3.13/js/bootstrap.min.js"></script>
 	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-modal/2.2.6/js/bootstrap-modalmanager.min.js"></script>
 	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
 	<link rel="icon" type="image/png" href="images/chicken-icon.png">
</head>

<body>

<div class="container" >

	<div class="container" style="padding:15px;">
		<div class="row">
	    	<div class="col-md-12">
	    		<h1>Chickens and Corn Game <img src="images/chicken-icon.png" style="width:64px;"></h1>
	    		<a href="api.html" target="_blank">API</a> |
	    		<a href="about.html" target="_blank">About</a> 
	    	</div>
	    	
	 	</div>
	</div>
   

 	<div class="row">
	    <div class="col-md-12">
		    <div class="panel panel-primary" >
		    	<div class="panel-heading" >
					<h3 class="panel-title">Controls</h3>
				</div>
				<div class="panel-body" >
					
						<button type="button" class="btn btn-default" onclick="next()" id="nextBtn">
							<span class="glyphicon glyphicon-step-forward"></span> Next Move
						</button>
						<button type="button" class="btn btn-default" onclick="prev()" id="prevBtn">
							<span class="glyphicon glyphicon-step-backward"></span> Prev Move
						</button>
						<button type="button" class="btn btn-default" onclick="restart()" id="restartBtn">
							<span class="glyphicon glyphicon-refresh"></span> Restart
						</button>
						<button type="button" class="btn btn-default" onclick="updateAlgorithms()" id="updateBtn">
							<span class="glyphicon glyphicon-cloud-upload"></span> Update Algorithms
						</button>
						<button type="button" class="btn btn-default" onclick="multiRun()" id="multiRunBtn">
							<span class="glyphicon glyphicon-list-alt"></span> Multi-run
						</button>
				</div>
		    </div>
	    </div>

    </div>
    
 	<div class="row">
	 	<div class="col-md-4">
	 	
			<div class="panel panel-info" >
				<div class="panel-heading" >
			    	<h3 id="titleGameboard" class="panel-title">Gameboard</h3>
			    </div>
			    <div class="panel-body" style="min-height: 500px; margin-top: 0; margin-bottom: 0; padding-top: 0; padding-bottom:0;">
			    	<table id="gameboard">
			    		<tr></tr>
						<tr>
							<td class="gameboard-cell"></td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">0</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">1</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">2</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">3</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">4</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">5</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">6</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray">7</td>
							<td ></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">0</td>
							<td class="gameboard-cell gameboard-shaded" id="P0_0" onclick="cell()"></td>
							<td class="gameboard-cell" id="P1_0" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P2_0" onclick="cell()"></td>
							<td class="gameboard-cell" id="P3_0 onclick="cell()""></td>
							<td class="gameboard-cell gameboard-shaded" id="P4_0 onclick="cell()""></td>
							<td class="gameboard-cell" id="P5_0 onclick="cell()""></td>
							<td class="gameboard-cell gameboard-shaded" id="P6_0 onclick="cell()""></td>
							<td class="gameboard-cell"  style="border-right: 1px solid gray;" id="P7_0 onclick="cell()""></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">1</td>
							<td class="gameboard-cell" id="P0_1 onclick="cell()""></td>
							<td class="gameboard-cell gameboard-shaded" id="P1_1 onclick="cell()""></td>
							<td class="gameboard-cell" id="P2_1 onclick="cell()""></td>
							<td class="gameboard-cell gameboard-shaded" id="P3_1 onclick="cell()""></td>
							<td class="gameboard-cell" id="P4_1" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P5_1" onclick="cell()"></td>
							<td class="gameboard-cell" id="P6_1" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded"  style="border-right: 1px solid gray" id="P7_1" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">2</td>
							<td class="gameboard-cell gameboard-shaded" id="P0_2" onclick="cell()"></td>
							<td class="gameboard-cell" id="P1_2" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P2_2" onclick="cell()"></td>
							<td class="gameboard-cell" id="P3_2" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P4_2" onclick="cell()"></td>
							<td class="gameboard-cell" id="P5_2" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P6_2" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-right: 1px solid gray" id="P7_2" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">3</td>
							<td class="gameboard-cell" id="P0_3" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P1_3" onclick="cell()"></td>
							<td class="gameboard-cell" id="P2_3" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P3_3" onclick="cell()"></td>
							<td class="gameboard-cell" id="P4_3" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P5_3" onclick="cell()"></td>
							<td class="gameboard-cell" id="P6_3" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded"  style="border-right: 1px solid gray" id="P7_3" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">4</td>
							<td class="gameboard-cell gameboard-shaded" id="P0_4" onclick="cell()"></td>
							<td class="gameboard-cell" id="P1_4" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P2_4" onclick="cell()"></td>
							<td class="gameboard-cell" id="P3_4" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P4_4" onclick="cell()"></td>
							<td class="gameboard-cell" id="P5_4" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P6_4" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-right: 1px solid gray" id="P7_4" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr> 
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">5</td>
							<td class="gameboard-cell" id="P0_5" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P1_5" onclick="cell()"></td>
							<td class="gameboard-cell" id="P2_5" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P3_5" onclick="cell()"></td>
							<td class="gameboard-cell" id="P4_5" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P5_5" onclick="cell()"></td>
							<td class="gameboard-cell" id="P6_5" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded"  style="border-right: 1px solid gray" id="P7_5" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">6</td>
							<td class="gameboard-cell gameboard-shaded" id="P0_6" onclick="cell()"></td>
							<td class="gameboard-cell" id="P1_6" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P2_6" onclick="cell()"></td>
							<td class="gameboard-cell" id="P3_6" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P4_6" onclick="cell()"></td>
							<td class="gameboard-cell" id="P5_6" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P6_6" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-right: 1px solid gray" id="P7_6" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td class="gameboard-cell" style="border-right: 1px solid gray">7</td>
							<td class="gameboard-cell" style="border-bottom: 1px solid gray; border-bottom: 1px solid gray" id="P0_7" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P1_7" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-bottom: 1px solid gray; border-bottom: 1px solid gray" id="P2_7" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P3_7" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-bottom: 1px solid gray; border-bottom: 1px solid gray" id="P4_7" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded" id="P5_7" onclick="cell()"></td>
							<td class="gameboard-cell"  style="border-bottom: 1px solid gray; border-bottom: 1px solid gray" id="P6_7" onclick="cell()"></td>
							<td class="gameboard-cell gameboard-shaded"  style="border-bottom: 1px solid gray; border-right: 1px solid gray" id="P7_7" onclick="cell()"></td>
							<td style="border-left: 1px solid gray"></td>
						</tr>
						<tr>
							<td></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td style="border-top: 1px solid gray"></td>
							<td ></td>
						</tr>
						
					</table>
					<div class="container" style="height: 200px; width: 100%; "><br>
 						<textarea id="console" style="width: 100%; min-height: 200px; font-family:'Courier'; font-size: 8pt;" > </textarea>
 					</div>

			  	</div>

			</div>
		
		</div>

            <div class="col-md-8">
               <div class="panel panel-success">
                  <div class="panel-heading">
                  <h3 id="titleAlgorithm" class="panel-title">Algorithms</h3>
                  </div>
                  <div class="panel-heading">
                     <ul class="nav nav-tabs">
                        <li><a class="nav-link" data-toggle="tab" href="#rooster">Rooster</a></li>
                        <li class="active"><a class="nav-link" data-toggle="tab" href="#farmer">Farmer</a></li>
                        <li><a class="nav-link" data-toggle="tab" href="#wife">Wife</a></li>
                        <li><a class="nav-link" data-toggle="tab" href="#hen">Hen</a></li>
                     </ul>
                  </div>
                  <div class="panel-body" >
                  
                  <div class="tab-content" >
					<div id="rooster" class="container tab-pane" style="height: 100%; width: 100%; min-height: 400px;"><br>
 						<textarea id="roosterAlgorithm" style="min-width: 100%; min-height: 400px; font-family:'Courier'; font-size: 8pt;" > </textarea>
 					</div>
                  
					<div id="farmer" class="container tab-pane active" style="height: 100%; width: 100%; min-height: 400px;"><br>
 						<textarea id="farmerAlgorithm" style="width: 100%; height: 100%; min-height: 400px; font-family:'Courier'; font-size: 8pt;" ></textarea>
 					</div>
                  
					<div id="wife" class="container tab-pane" style="height: 100%; width: 100%; min-height: 400px;"><br>
 						<textarea id="wifeAlgorithm" style="width:100%; height: 100%; min-height: 400px; font-family:'Courier'; font-size: 8pt;" ></textarea>
 					</div>
                  
					<div id="hen" class="container tab-pane" style="height: 100%; width: 100%; min-height: 400px;"><br>
 						<textarea id="henAlgorithm" style="width:100%; height: 100%; min-height: 400px; font-family:'Courier'; font-size: 8pt;" ></textarea>
 					</div>
                  
                  </div>
               </div>
            </div>
   </div>

	
</div> <!--  outer container -->
	    
	<script src="js/position.js"></script>
	<script src="js/piece.js"></script>
	<script src="js/game2.js"></script>
	<script type="text/javascript">
	
	// initial piece placements	
	var Rooster = {
			"row": 4,
			"col": 0,
			"active": true,
			"algorithm": "Me.moveRandom()",
			"visible": true
		};

	var Farmer = {
			"row": 4,
			"col": 2,
			"active": true,
			"algorithm": "Me.moveRandom()",
			"visible": true
		};

	var Wife = {
			"row": 4,
			"col": 5,
			"active": true,
			"algorithm": "Me.moveRandom()",
			"visible": true
		};

	var Hen = {
			"row": 4,
			"col": 7,
			"active": true,
			"algorithm": "Me.moveRandom()",
			"visible": true
		};

	var currentMove = 0;
	var totalMoves = 1;
	
	var gameWorker;
	
	function updateDisplay(){
		var board = document.getElementById("gameboard");
		setBoard(board);
		
		var title = document.getElementById("titleGameboard");
		title.innerHTML = "Gameboard - Moves: " + currentMove + '/' + (totalMoves-1);
		
		$('#roosterAlgorithm').innerHTML = Rooster.algorithm;
		$('#farmerAlgorithm').innerHTML = Farmer.algorithm;
		$('#wifeAlgorithm').innerHTML = Wife.algorithm;
		$('#henAlgorithm').innerHTML = Hen.algorithm;
		
	}

	function setBoard(board) {

		// first clear all rows/cols
		for( var r = 2; r<board.rows.length; r++){
			for( var c = 1; c<=board.rows[r].cells.length; c++ ) {
				if( board.rows[r].cells[c] ) {
					board.rows[r].cells[c].innerHTML = " ";
				}
			}
		}
		
		if( Rooster.active ) {
			board.rows[Rooster.row+2].cells[Rooster.col+1].innerHTML = "R";
		} else {
			board.rows[Rooster.row+2].cells[Rooster.col+1].innerHTML = "X";
		}

		if( Farmer.active ) {
			board.rows[Farmer.row+2].cells[Farmer.col+1].innerHTML = "F";
		} else {
			board.rows[Farmer.row+2].cells[Farmer.col+1].innerHTML = "X";
		}
		
		if( Wife.active ) {
			board.rows[Wife.row+2].cells[Wife.col+1].innerHTML = "W";
		} else {
			board.rows[Wife.row+2].cells[Wife.col+1].innerHTML = "X";
		}

		if( Hen.active ) {
			board.rows[Hen.row+2].cells[Hen.col+1].innerHTML = "H";
		} else {
			board.rows[Hen.row+2].cells[Hen.col+1].innerHTML = "X";
		}

	}
	
	function restart(){
		$('#nextBtn').prop("disabled",true);
		$('#prevBtn').prop("disabled",true);
		
		var elm = document.getElementById("console");
		elm.value = "";
		
		currentMove = 0;
		totalMoves = 1;  // the initial board set
		
		Rooster.row = 4;
		Rooster.col = 0;
		Rooster.active = true;
        Rooster.visible = true;

		Farmer.row = 4;
		Farmer.col = 2;
		Farmer.active = true;
		Farmer.visible = true;

        Wife.row = 4;
        Wife.col = 5;
        Wife.active = true;
        Wife.visible = true;
		
		Hen.row = 4;
		Hen.col = 7;
		Hen.active = true;
		Hen.visible = true;
		
		updateAlgorithms();
		
		var initializationData = {
				"rooster": Rooster,
				"farmer": Farmer,
				"wife": Wife,
				"hen": Hen,
				"currentMove": 0,
				"totalMoves": 0
			};
			
		gameWorker.postMessage({ "action": "initialize", "pieces": initializationData } );	

		updateDisplay();
	}
	
	function multiRun(){
		$('#avgModal').modal('show');
	}
	
	
	function log(msg){
		var elm = document.getElementById("console");
		if( elm ) {
			var val = elm.value;
			if( val.length>0 ){
				val = val + '\n' + msg;
			} else {
				val = msg;
			}
			
			elm.value = val;
			elm.scrollTop = elm.scrollHeight;
		}
	}
	

	function startGame() {

		updateDisplay();
		
		$('#nextBtn').prop("disabled",true);
		
		if( typeof(gameWorker) == "undefined" ) {
			gameWorker = new Worker("js/gameWorker.js");
			gameWorker.onmessage = function(event){
				if( event.data.log ) {
					log(event.data.log);
				}
				if( event.data.ready ) {
					
					currentMove = event.data.currentMove;
					totalMoves = event.data.totalMoves;
					
					var player;
					player = event.data.pieces.rooster;
					Rooster.row = player.row;
					Rooster.col = player.col;
					Rooster.active = player.active;

					player = event.data.pieces.farmer;
					Farmer.row = player.row;
					Farmer.col = player.col;
					Farmer.active = player.active;

					player = event.data.pieces.wife;
					Wife.row = player.row;
					Wife.col = player.col;
					Wife.active = player.active;

					player = event.data.pieces.hen;
					Hen.row = player.row;
					Hen.col = player.col;
					Hen.active = player.active;
					
					$('#nextBtn').prop("disabled",false);
				} else {
					$('#nextBtn').prop("disabled",true);
				}
				updateDisplay();
			}
		}
		
		var initializationData = {
			"rooster": Rooster,
			"farmer": Farmer,
			"wife": Wife,
			"hen": Hen
		};
		
		gameWorker.postMessage({ "action": "initialize", "pieces": initializationData } );	
		
 	}
	
	function next(){
		gameWorker.postMessage({ "action": "next" } );
	}
	
	function prev(){
		gameWorker.postMessage({ "action": "prev" } );
	}
	

	
	//=====================================================================================================
	// Simulation (multiRun) functions
	
	var simulationWorker;
	
	function multiRun(){
		// toggles
		if( typeof(simulationWorker) == "undefined" ) {
			simulationWorker = new Worker("js/gameWorker.js");
			simulationWorker.onmessage = function(event){
				if( event.data.log ) {
					log(event.data.log);
				}
				if( event.data.ready ) {
					setTimeout( gameWorker.postMessage({ "action": "next" } ), 100 );	
				} 
				
				if( event.data.totalMoves ) {
					multilog( event.data.totalMoves );
					// reset
					
				}
			}
			var initializationData = {
					"rooster": Rooster,
					"farmer": Farmer,
					"wife": Wife,
					"hen": Hen
				};
				
			simulationWorker.postMessage({ "action": "initialize", "pieces": initializationData } );	
		} else {
			simulationWorker.terminate();
		}
		
	}
	
	function stopSimulation(){
		simulationWorker.terminate();
	}
	
	function startSimulation() {
		if( typeof(simulationWorker) == "undefined" ) {
			simulationWorker = new Worker("js/gameWorker.js");
			simulationWorker.onmessage = function(event){
				if( event.data.log ) {
					log(event.data.log);
				}
				if( event.data.ready ) {
					setTimeout( gameWorker.postMessage({ "action": "next" } ), 100 );	
				} 
				
				if( event.data.totalMoves ) {
					multilog( event.data.totalMoves );
					// reset
					
				}
			}
		}
		
		var initializationData = {
			"rooster": Rooster,
			"farmer": Farmer,
			"wife": Wife,
			"hen": Hen
		};
		
		simulationWorker.postMessage({ "action": "initialize", "pieces": initializationData } );	
		
 	}
	
	function simulationNext(){
		while( gameRunning) {
			setTimeout( simulationWorker.postMessage({ "action": "next" } ), 100 );	
		}
		
/* 		for( var i=0; i<5; i++ ) {
			Game._reset();
			setTimeout(simulateRun(), 1000);
			var m = Game.totalMoves();
			alert(m);
		}
 */

	}
	
	function simulateRun(){
		setTimeout(Game._next(), 1);
		var stillRunning = Game.isActive();
		while( stillRunning ){
			setTimeout(Game._next(), 1);
			stillRunning = Game.isActive();
			//console.log(Game.totalMoves());
		}
	}
	
	function simLog(msg){
		var elm = document.getElementById("multirunConsole");
		if( elm ) {
			var val = elm.value;
			if( val.length>0 ){
				val = val + '\n' + msg;
			} else {
				val = msg;
			}
			
			elm.value = val;
			elm.scrollTop = elm.scrollHeight;
		}
	}

	function stopSimulation() {
	
	}
	

	function updateAlgorithms(){
		var elm;
		var algorithm;

		elm = document.getElementById("roosterAlgorithm");
		algorithm = elm.value;
		Rooster._algorithm = algorithm;
		
		elm = document.getElementById("farmerAlgorithm");
		algorithm = elm.value;
		Farmer._algorithm = algorithm;

		elm = document.getElementById("wifeAlgorithm");
		algorithm = elm.value;
		Wife._algorithm = algorithm;

		elm = document.getElementById("henAlgorithm");
		algorithm = elm.value;
		Hen._algorithm = algorithm;
	}
	
	function setPosition(piece){
		var board = document.getElementById('gameboard'),
	    cells = board.getElementsByTagName('td');

		for (var i=0,len=cells.length; i<len; i++){
	    	cells[i].onclick = function(){
	    		var col = Number(this.id.charAt(1));
	    		var row = Number(this.id.charAt(3));
		        
		        if( !Game.isOccupied(row, col) ) {
		        	piece.row = row;
		        	piece.col = col;
			        for (var j=0,len=cells.length; j<len; j++){
				    	cells[j].onclick = null;
					}
			        setBoard(board);
		        } else {
					alert("Position must be empty to set another piece.");		        	
		        }
		        
	    	}
		}
		updateDisplay();
		
	};
	
	


	function readDefaultAlgorithm(piece, url, elm)	{
	    var rawFile = new XMLHttpRequest();
	    rawFile.open("GET", url, false);
	    rawFile.onreadystatechange = function (){
	        if(rawFile.readyState === 4){
	            if(rawFile.status === 200 || rawFile.status == 0) {
	                piece.algorithm = rawFile.responseText;
	                var target = document.getElementById(elm);
	                target.innerHTML = piece.algorithm;
	            }
	        }
	    }
	    rawFile.send(null);
	}

	readDefaultAlgorithm(Rooster, "js/rooster.js", 'roosterAlgorithm');
	readDefaultAlgorithm(Farmer, "js/farmer.js", 'farmerAlgorithm');
	readDefaultAlgorithm(Wife, "js/wife.js", 'wifeAlgorithm');
	readDefaultAlgorithm(Hen, "js/hen.js", 'henAlgorithm');

	window.addEventListener('log', function(event){

	var elm = document.getElementById("console");
		if( elm ) {
			var val = elm.value;
			if( val.length>0 ){
				val = val + '\n' + event.detail;
			} else {
				val = event.detail;
			}
			
			elm.value = val;
			elm.scrollTop = elm.scrollHeight;
		}
	});
	
	var table = document.getElementById("gameboard");
	if (table != null) {
	    for (var i = 0; i < table.rows.length; i++) {
	        for (var j = 0; j < table.rows[i].cells.length; j++)
	        table.rows[i].cells[j].onclick = function () {
	            tableText(this);
	        };
	    }
	}

	var movingPiece = false;
	var pieceCode;
	var oldColor;
	var oldCell;
	
	function tableText(tableCell) {
		var val = tableCell.innerHTML;
		if( val != " " ){
			pieceCode = tableCell.innerHTML;
		    oldColor = tableCell.style.backgroundColor;
		    tableCell.style.backgroundColor = "lightGreen";
		    oldCell = tableCell;
		    movingPiece = true;
		} else if( movingPiece ) {
			tableCell.innerHTML = pieceCode;	
			oldCell.innerHTML = " ";
			oldCell.style.backgroundColor = oldColor;
			movingPiece = false;
			oldCell = undefined;
			oldColor = undefined;
			
			var id = tableCell.id;
			var row = Number(id.charAt(1));
			var col = Number(id.charAt(3));
			if( pieceCode == 'R' ) {
				Rooster.row = row;
				Rooster.col = col;
			}
			if( pieceCode == 'F' ) {
				Farmer.row = row;
				Farmer.col = col;
			}
			if( pieceCode == 'W' ) {
				Wife.row = row;
				Wife.col = col;
			}
			if( pieceCode == 'H' ) {
				Hen.row = row;
				Hen.col = col;
			}
			
			gameWorker.postMessage({ 
				"action": "set", 
				"rooster": { "row": Rooster.row, "col": Rooster.col },
				"farmer": { "row": Farmer.row, "col": Farmer.col },
				"wife": { "row": Wife.row, "col": Wife.col },
				"hen": { "row": Hen.row, "col": Hen.col }				
			} );
			
		}
	}
	
	
	startGame();
	
	</script>

  </body>
</html>


